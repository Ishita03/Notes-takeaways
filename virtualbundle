{"value":"{\"virtual_bundle_parent_tcin\":\"5464312\",\"components\":[{\"component_tcin\":\"12959609\",\"quantity\":1,\"saving_override\":false,\"saving\":{\"type\":\"PERCENT_OFF\",\"value\":5.0}},{\"component_tcin\":\"12958808\",\"quantity\":1,\"saving_override\":false,\"saving\":{\"type\":\"PERCENT_OFF\",\"value\":5.0}}]}","key":"5464312","offset":8,"partition":3,"timestamp":"2024-10-24 13:10:50.9","timestampType":0,"topic":"bundle-changes-dev"}
{"key":"5464312","offset":9,"partition":3,"timestamp":"2024-10-24 16:51:55.14","timestampType":0,"topic":"bundle-changes-dev"}



tcin      time    tcin_prev    scd2      
5464312    13     5464312        I  
5464312    16                    D    




5464312    


price publish --->set response , sdm , hq

check compacted files for price publish   -- 2021-2022 


check quota for all nuid 


hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/tmp/SdmStoreEvents/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/tmp/StoreActivationFeedback/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/tmp/TimelineChangeNotification/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/tmp/test/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/test_ci_digital_pricing/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/priceThresholdsInsightsEvents/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/omniChannelTargetPrice_stg/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/ClusterMapping/*
        hdfs dfs -rm -r /user/SVPRISTRMHDP/data/price/landing/CompetitorShopresultsShopright/*


        price_elactivy_ingestion



    3991--->2024



        1000  -  900  =
        
        
        100  
        900
        insert 
        +----------------------------+-----------------------+---------+-------------+------------------------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+--------------------------------+-----+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+
|tcin_location_from_kafka_key|timestamp              |partition|key          |activation_id                                         |offset    |tcin    |activation_timestamp|reg_retail|default_price|current_retail|discount_value|external_system_name|discount_type|location_id|previous_reg_retail|current_retail_type|current_retail_end_timestamp|last_update_timestamp|kafka_publish_timestamp|external_system_id              |msrp |current_retail_start_timestamp|map |channel_n|effective_utc_ts    |effective_d|batch_update_utc_ts |expiry_utc_ts       |expiry_d  |active_f|delete_f|
+----------------------------+-----------------------+---------+-------------+------------------------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+--------------------------------+-----+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+
|54550558                    |2024-05-05 02:01:27.119|28       |54550558-3991|20240423201011213-2cb39d22-e6bc-4dea-99a3-8af9feb330c4|1020729042|54550558|2024-05-02T19:03:49Z|24.99     |false        |17.49         |30.0          |IVYPROMO            |PERCENT_OFF  |3991       |24.99              |S                  |2024-05-12T06:59:59Z        |2024-05-02T19:03:49Z |2024-05-05T07:01:27Z   |461250010                       |24.99|2024-05-05T07:00:00Z          |NULL|DIGITAL  |2024-05-05T07:01:27Z|2024-05-05 |2024-11-13T16:56:34Z|2024-05-12T07:00:13Z|2024-05-12|N       |N       |
|54550558                    |2024-05-12 02:00:13.817|28       |54550558-3991|5b4f3216108a470899000ef74f4ade09                      |1024417329|54550558|2019-08-24T23:38:30Z|24.99     |false        |24.99         |0.0           |IVY                 |NULL         |3991       |NULL               |R                  |9999-12-31T06:00:00Z        |2019-08-24T23:38:30Z |2024-05-12T07:00:13Z   |8f9e1e5ba7d44a78be5babb05bd55122|24.99|2019-03-13T07:00:00Z          |NULL|DIGITAL  |2024-05-12T07:00:13Z|2024-05-12 |2024-11-13T16:56:34Z|9999-12-31T00:00:00Z|9999-12-31|Y       |N       |
+----------------------------+-----------------------+---------+-------------+------------------------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+--------------------------------+-----+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+


+----------------------------+-----------------------+---------+-------------+------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+------------------------+------+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+-------+
|tcin_location_from_kafka_key|timestamp              |partition|key          |activation_id                       |offset    |tcin    |activation_timestamp|reg_retail|default_price|current_retail|discount_value|external_system_name|discount_type|location_id|previous_reg_retail|current_retail_type|current_retail_end_timestamp|last_update_timestamp|kafka_publish_timestamp|external_system_id      |msrp  |current_retail_start_timestamp|map |channel_n|effective_utc_ts    |effective_d|batch_update_utc_ts |expiry_utc_ts       |expiry_d  |active_f|delete_f|row_num|
+----------------------------+-----------------------+---------+-------------+------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+------------------------+------+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+-------+
|91191470                    |2024-02-07 17:50:32.443|17       |91191470-3991|e018ce4d-4ef5-4669-ad14-9e9debffdfe0|1530700980|91191470|2024-02-07T23:50:29Z|124.99    |false        |124.99        |0.0           |TGTPLUS             |NULL         |3991       |124.99             |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:50:29Z |2024-02-07T23:50:32Z   |65c4159c2a846a7dafefaf5a|124.99|2024-02-07T23:50:28Z          |NULL|DIGITAL  |2024-02-07T23:50:32Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:50:32Z|2024-02-07|N       |N       |1      |
|91191720                    |2024-02-07 17:53:01.13 |25       |91191720-3991|e372ad68-782d-4d25-b46e-044f41839571|1146134147|91191720|2024-02-07T23:52:59Z|48.8      |false        |48.8          |0.0           |TGTPLUS             |NULL         |3991       |48.8               |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:52:59Z |2024-02-07T23:53:01Z   |65c415d32a846a7daff1d27f|NULL  |2024-02-07T23:52:54Z          |NULL|DIGITAL  |2024-02-07T23:53:01Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:53:01Z|2024-02-07|N       |N       |1      |
|91191841                    |2024-02-07 17:50:29.367|25       |91191841-3991|44e8492c-c17f-4d6a-b23f-2602097f8611|1146134089|91191841|2024-02-07T23:50:28Z|50.19     |false        |50.19         |0.0           |TGTPLUS             |NULL         |3991       |50.19              |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:50:28Z |2024-02-07T23:50:29Z   |65c415db2a846a7daff21c05|50.19 |2024-02-07T23:50:26Z          |NULL|DIGITAL  |2024-02-07T23:50:29Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:50:29Z|2024-02-07|N       |N       |1      |
|91191852                    |2024-02-07 17:50:47.77 |25       |91191852-3991|3019ed6f-70b4-4e61-aa3f-55fad9b00820|1146134108|91191852|2024-02-07T23:50:45Z|81.79     |false        |81.79         |0.0           |TGTPLUS             |NULL         |3991       |81.79              |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:50:45Z |2024-02-07T23:50:47Z   |65c415e72a846a7daff28c98|81.79 |2024-02-07T23:50:41Z          |NULL|DIGITAL  |2024-02-07T23:50:47Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:50:47Z|2024-02-07|N       |N       |1      |
|91191483                    |2024-02-07 17:53:04.204|19       |91191483-3991|99f58e48-f53b-4ebe-8942-3d07f4074f38|1482904566|91191483|2024-02-07T23:53:02Z|94.99     |false        |94.99         |0.0           |TGTPLUS             |NULL         |3991       |94.99              |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:53:02Z |2024-02-07T23:53:04Z   |65c4159a2a846a7dafefa229|94.99 |2024-02-07T23:52:54Z          |NULL|DIGITAL  |2024-02-07T23:53:04Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:53:04Z|2024-02-07|N       |N       |1      |
|91191896                    |2024-02-07 17:50:32.446|25       |91191896-3991|2ebb5955-c5b3-48d6-adc5-c1719ef247d9|1146134092|91191896|2024-02-07T23:50:32Z|66.8      |false        |66.8          |0.0           |TGTPLUS             |NULL         |3991       |66.8               |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:50:32Z |2024-02-07T23:50:32Z   |65c415f42a846a7daff2faed|66.8  |2024-02-07T23:50:31Z          |NULL|DIGITAL  |2024-02-07T23:50:32Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:50:32Z|2024-02-07|N       |N       |1      |
|91191973                    |2024-02-07 17:52:54.271|25       |91191973-3991|108efa19-ad82-400e-804b-95f61f1678c7|1146134139|91191973|2024-02-07T23:52:52Z|137.6     |false        |137.6         |0.0           |TGTPLUS             |NULL         |3991       |137.6              |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:52:52Z |2024-02-07T23:52:54Z   |65c4161a2a846a7daff4da12|137.6 |2024-02-07T23:52:37Z          |NULL|DIGITAL  |2024-02-07T23:52:54Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:52:54Z|2024-02-07|N       |N       |1      |
|91191478                    |2024-02-07 17:50:32.431|25       |91191478-3991|66650893-c33a-4519-99ba-4fd461e55a25|1146134091|91191478|2024-02-07T23:50:29Z|646.4     |false        |646.4         |0.0           |TGTPLUS             |NULL         |3991       |646.4              |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:50:29Z |2024-02-07T23:50:32Z   |65c4158a2a846a7dafef3f93|646.4 |2024-02-07T23:50:28Z          |NULL|DIGITAL  |2024-02-07T23:50:32Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:50:32Z|2024-02-07|N       |N       |1      |
|91191690                    |2024-02-07 17:53:01.136|17       |91191690-3991|cd23e820-e77f-4772-a43f-474d103d9af9|1530701044|91191690|2024-02-07T23:52:57Z|44.99     |false        |44.99         |0.0           |TGTPLUS             |NULL         |3991       |44.99              |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:52:57Z |2024-02-07T23:53:01Z   |65c415d52a846a7daff1e13b|44.99 |2024-02-07T23:52:46Z          |NULL|DIGITAL  |2024-02-07T23:53:01Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:53:01Z|2024-02-07|N       |N       |1      |
|91191885                    |2024-02-07 17:53:01.1  |25       |91191885-3991|18b65119-ba52-45c5-bce8-ccbf47c0ffdf|1146134143|91191885|2024-02-07T23:52:57Z|126.2     |false        |126.2         |0.0           |TGTPLUS             |NULL         |3991       |126.2              |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:52:57Z |2024-02-07T23:53:01Z   |65c415f92a846a7daff334b5|126.2 |2024-02-07T23:52:47Z          |NULL|DIGITAL  |2024-02-07T23:53:01Z|2024-02-07 |2024-11-13T17:19:09Z|2024-02-07T23:53:01Z|2024-02-07|N       |N       |1      |
+----------------------------+-----------------------+---------+-------------+------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+------------------------+------+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+-------+


+----------------------------+-----------------------+---------+-------------+------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+------------------------+------+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+
|tcin_location_from_kafka_key|timestamp              |partition|key          |activation_id                       |offset    |tcin    |activation_timestamp|reg_retail|default_price|current_retail|discount_value|external_system_name|discount_type|location_id|previous_reg_retail|current_retail_type|current_retail_end_timestamp|last_update_timestamp|kafka_publish_timestamp|external_system_id      |msrp  |current_retail_start_timestamp|map |channel_n|effective_utc_ts    |effective_d|batch_update_utc_ts |expiry_utc_ts       |expiry_d  |active_f|delete_f|
+----------------------------+-----------------------+---------+-------------+------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+------------------------+------+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+
|91191470                    |2024-02-07 17:50:32.443|17       |91191470-3991|e018ce4d-4ef5-4669-ad14-9e9debffdfe0|1530700980|91191470|2024-02-07T23:50:29Z|124.99    |false        |124.99        |0.0           |TGTPLUS             |NULL         |3991       |124.99             |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:50:29Z |2024-02-07T23:50:32Z   |65c4159c2a846a7dafefaf5a|124.99|2024-02-07T23:50:28Z          |NULL|DIGITAL  |2024-02-07T23:50:32Z|2024-02-07 |2024-11-13T17:41:19Z|2024-02-07T23:50:32Z|2024-02-07|N       |N       |
|91191470                    |2024-02-07 17:50:32.443|17       |91191470-3991|e018ce4d-4ef5-4669-ad14-9e9debffdfe0|1530700980|91191470|2024-02-07T23:50:29Z|124.99    |false        |124.99        |0.0           |TGTPLUS             |NULL         |3991       |124.99             |R                  |9999-12-31T00:00:00Z        |2024-02-07T23:50:29Z |2024-02-07T23:50:32Z   |65c4159c2a846a7dafefaf5a|124.99|2024-02-07T23:50:28Z          |NULL|DIGITAL  |2024-02-07T23:50:32Z|2024-02-07 |2024-11-13T17:41:19Z|9999-12-31T00:00:00Z|9999-12-31|Y       |N       |
+----------------------------+-----------------------+---------+-------------+------------------------------------+----------+--------+--------------------+----------+-------------+--------------+--------------+--------------------+-------------+-----------+-------------------+-------------------+----------------------------+---------------------+-----------------------+------------------------+------+------------------------------+----+---------+--------------------+-----------+--------------------+--------------------+----------+--------+--------+


SELECT DISTINCT tcin
    , case when regular_retail_a = 0 then previous_regular_retail_a else regular_retail_a end as tgt_reg_retail_a
    , effective_d
    , expiry_d
FROM prd_priceent_wrk.omnichannel_target_price
WHERE expiry_year_month >= '2024-11'
    AND channel_n = 'DIGITAL'
and tcin in ('91776614',
'54397377',
'91776318',
'54271054',
'54268647',
'91711100',
'54397377',
'54271054',
'91776318')


insert into prd_priceent_fnd.omnichannel_target_price
select * from stg_priceent_wrk.omnichannel_target_price_external
where expiry_year_month = '9999-12'